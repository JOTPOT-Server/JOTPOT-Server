<div ID="main-container">
	<style>
		#main-container {
			font-family: Arial, Helvetica, sans-serif;
			background-color: #fff;
			color: #004;
			padding: 8px;
			padding-left: 20px;
			padding-right: 50px;
			text-align: left;
		}
		h1,h2,h3 {
			font-family: Arial, Helvetica, sans-serif;
			color: #008;
		}
		a {
			background-color: #e0e0e0;
			box-sizing: border-box;
			border-radius: 3px;
			padding: 3px;
			color: #008;
		}
		.details {
			padding: 0px;
			font-size: 0.9em;
			padding-left: 15px;
		}
		.details>ul {
			margin: 3px;
			margin-left: -15px;
			font-size: 0.85em;
		}
		.supported {
			color: green;
		}
		.notsupported {
			color: red;
		}
		.func-h3 {
			margin-bottom: 0px;
		}
		.args-list {
			font-size: 1.2em;
			margin-top: 3px;
			margin-bottom: 10px;
			padding-left: 45px;
		}
		.desc {
			font-size: 1.15em;
			padding-left: 55px;
			margin-top: -5px;
		}
		.indent {
			padding-left: 20px;
		}
	</style>
	<h1>JOTPOT Server Docs <span style="font-size: 0.8em;">26B</span><span style="font-size: 0.6em;">-0</span></h1>
	<a href="/server" style="float: right;" ID="the_link">JOTPOT Server Main Page</a>

	<div class="indent">

		<i>Please note that this page is still a work in progress, and is no where near complete. It may not look the best yet but the content should be good :)</i>
		<h2>Quick Links</h2>
		<a href="#server-object">'server' object reference</a>
		<a href="#request-object">'request' object reference</a>
		<a href="#response-object">'response' object reference</a>
		<a href="#url-object">'url' object reference</a>
		<h2>Getting started</h2>
		<div class="indent">
			<p>Welcome the the documentation for JOTPOT Server, this first section is a guide on getting started with JOTPOT Server.</p>
			
			<h3>What is JOTPOT Server???</h3>
			<p>JOTPOT Server is a web server and/or load balencer writen in Node.js and Go.</p>
			<p>It is designed to be easy to setup and use. Once installed (which is simple), you can setup and get a server running in just 2 commands, and customizing it is as simple as changing a json file.</p>
			<p>If you want to go super simple, JOTPOT Server can be a great solution for a simple file server without having to change the config, it can even handle multiple hosts.</p>
			<p>Or, if you want a little more, with a config file alone it can be set up to serve the pages you need, have rules for CORS, serve the same file for multiple URLs, redirect users to the HTTPS version of your site when they request an upgrade and a huge amount more.</p>
			<p>But, if you want more control, you can write JavaScript files that has access to an extensive API that gives you any level of control, from simply observing requests and responses, to forcing client downloads, to adding compression or templating to your served files, to taking full control over any amount of requests, based on any factors.</p>
			<p>The API for extensions also gives you simple and easy control over loads of things, such as CORS rules, caching, having aliases for hosts and pages, full account systems, that allow you to restrict pages, provide a login service and keep track of users.</p>
			<p>You can even use the API to go as far as implementing custom HTTP methods, and if the API doesn't satisfy your needs, then you can jump in and take over full control over any request at any time and handle it just as you would a normal server request in Node.js.</p>
			<p>Anything is possible with JOTPOT Server. And since it is based on Node.js, if something isn't build in, then you can use an extension to take full control over relivent URLs, requests with specific headers, methods, or anything else and handle the request just as you would with any other Node.js server (plus a few quality of life improvments that are there in the background if you choose to use them).</p>
			<p>JOTPOT Server can suit your projects needs.</p>
			<p>And, every line of code is completally open source and free! Forever.</p>
			
			<h3>Why run a web server in the first place?</h3>
			<p>Being here, I assume you have good motivations already, so I will keep this short.</p>
			<p>A web server can basicaly do anything, just look at Google Docs, or any other website you go to.</p>
			<p>Whether you want to run a blog, forum, service, shop, publication or anything on the web, you're going to need a server. And for some use cases JOTPOT Server is the choice for you.</p>
			<p>If your running a simple infomation site, JOTPOT Server will work great for you, simpily by adding your HTML code (that you can write yourself or use another programme to generate for you) to a directory on your server and running JOTPOT Server, your site will be up in seconds (maybe a minute or two depending on how type you can fast).</p>
			<p>Or, if you're building an online service or web app, JOTPOT Server is perfect, this was what the extension system was designed for. Run your JavaScript code server-side to do whatever you like, you can access everything you would normally access in Node.js, plus loads of simple APIs for interacting with the build in fetures in JOTPOT Server (all of which can be overriden with your own custom implementations). There truely are no limits.</p>
			<p>Anything else is possible too, although there may be more elegant solutions out there for some projects (but if you want to use JOTPOT Server, I ain't going to stop you!).</p>
			
			<h3>Download and installation</h3>
			<p>So, you have decided that you want to use JOTPOT Server (JPS)! YAY!!! Let's get started!</p>
			<p>To start, please make sure that you have a working installation of Node.js on your system. JOTPOT Server first checks through the PATH environment variable for a file called nodejs, then for one called node, so one of them should point to an installation of Node.js. It is recommended that you use the current LTS release of node. If you don't want a systemwide installation, then after you have installed JOTPOT Server, create a directory named node in the directory with the binary files in, and place the node executable in there.</p>
			<p>Next up, if upgrading, we recomend removing the old installation first.</p>
			<p>First off, download the correct package for your system, for downloads, see jotpot.uk/server or for more downloads (for even more platforms), see jotpot.uk/releases/26A-1/downloads.html</p>
			<p>You could also get the file via the command line via the following URL: https://jotpot.uk/releases/$VERSION/jps-$OS-$ARCH.tar.gz.</p>
			<p>Here is an exmaple of downloading version 26A-1 on linux for a x86-64 CPU:</p>
			<pre>
			wget https://jotpot.uk/releases/26A-1/jps-linux-x86-64.tar.gz</pre>
			<p>Next up, we recommend installing JOTPOT Server to the /usr/local/jps directory, if you wish to install it to a different directory, follow these same instructions, but with your own directory path.</p>
			<p>Installing will almost definatily require root priviliges, so you might want to run these commands in a root shell, use 'sudo su' to start a root shell.</p>
			<p>First, lets create the directory to install jps to. An example on linux:</p>
			<pre>
			mkdir /usr/local/jps</pre>
			<p>Next up, we need to extract the contents of the archive we downloaded to the install location, so the executables jps, jpsd and jpslb, along with the jps-main directory are in the root of your chosen directory. Another example on linux, extracting it into the /usr/local/jps directory:</p>
			<pre>
			tar -C /usr/local/jps -xzf jps-$OS-$ARCH.tar.gz</pre>
			<p>Next up, add it to the path. Again, an example on linux:</p>
			<pre>
			export PATH="$PATH:/usr/local/jps"</pre>
			<p>If you want to make this perminant, add it to the profile file. Either to /etc/profile for all users or ~/.profile for only your user.</p>
			<p>To test everything is working, run the 'jps' command. You should get an error saying that the sites directory must exist, or, if it does exist, then the server will boot up, just use ctrl^c to kill it.</p>
			<p>The 'jpsd' command, or 'jps start-daemon' command will start the daemon. If you want it to start on boot, you can use your init system to start it up (run 'jps start-daemon'), if you have systemd, then the 'jps make-unit-file' command will generate a unit file based on your current installation. To add this unit file as a service, run the following commands:</p>
			<pre>
			jps make-unit-file>/etc/systemd/system/jps.service</pre>
			systemctl enable jps
			#To start the daemon now
			systemctl start jps</pre>
			<p>If you want to run all those steps in one go, just start a root terminal ('sudo su') and paste in the following (but add your own system options, and leave out the unit file creation if you arn't using systemd)</p>
			<pre>
			#Set preferences
			OS="linux"
			ARCH="x86-64"
			VERSION="26A-1"
			#Download archive
			wget https://jotpot.uk/releases/$VERSION/jps-$OS-$ARCH.tar.gz
			#Create directory, extract and delete that archive
			mkdir /usr/local/jps
			tar -C /usr/local/jps -xzf jps-$OS-$ARCH.tar.gz
			rm jps-$OS-$ARCH.tar.gz
			#Add it to the path (you might want to add this line to the profile file to make this perminant)
			export PATH="$PATH:/usr/local/jps"
			#Create the unit file
			jps make-unit-file>/etc/systemd/system/jps.service</pre>
			systemctl enable jps
			#Start the daemon now
			systemctl start jps</pre>
			
			<h3>Setting up and an introduction</h3>
			<p>Now that we have JOTPOT Server installed, we can get on with setting it up.</p>
			<p>JOTPOT Server is controled in three manners, first is the config file, secondly is the command line arguments, and finally is the extensions.</p>
			<p>The config file is named 'config.json' and is (just incase you hadn't caught on) a JSON file (yes, that's right, the json file extension means that it is a JSON file!!! I bet I have just blown your mind). The server first checks in the working directory for the config file, then if it cannot find it there, in the jps-main directory (within the directory that jps was installed to).</p>
			<p>All of the properties of the config file are documented below, however we will talk about a few in this introduction. Later on, I will explain how one can be autogenerated, so hold your horses for a moment and read on for a bit.</p>
			<p>Next up, the flags (again documented below), if any of these are set, they override the relivent config property. They override it by changing it when it is loaded. The accual file is not modified, but after it is parsed, the relivent properties in the parsed object are changed.</p>
			<p>Finally the extensions. A more detailed expplanation of extensions are given below, but for now, all I will say is that the server.config object represents the config file, and thus any changes the that object change how the server works, so any changes the extensions make overrides the config file and the flags. It is also possible for extneions to change the way a file is handled in many other ways, including while it is being handled.</p>
			<p>Another file that the server requires is the error template, this is the file that is sent whenver an error occurs, it contains the error information that should be showen to the user. In the default config file, this is named 'errorTemp.jpt' and at the moment is shared accross all sites hosted by the server instance (this will be improved soon, probnably in 26B). If this file doesn't exist, the server has a built in default, so you don't really need to worry too much about this file if the server isn't for production use.</p>
			<p>Next up, we will talk about how files are served by the server. Understanding this is important because if used properly, many shortcuts can be used to make setting up the server much more simple, and maintaining it a whole lot eisier.</p>
			
			<span ID="how-jotpot-server-serves-files">
				<h2>How JOTPOT Server serves files</h2>
				<p>The sites directory is different for each server instance and should be located inside the working directory. It should consist only of directorys, each one being for a seperate host.</p>
				<p>When JOTPOT Server recievs a request for a file, it first checks for a directory named <b>hostname;port</b>. <b>Note how the ':' in the host is replaced with a semi-colon, making it suatable for most file systems.</b></p>
				<p>If that directory doesn't exist, it checks the config for the property "fallbackToNoPort". If true, it next checks for the directory named only the hostname (so without the port).</p>
				<p>Then, if that doesn't exist, it checks the "useDefaultHostIfHostDoesNotExist" property of the config. If true, it repeats the last steps, but with the default host defined by the "defaultHost" property of the config file, so (if the "defaultHost" property is "default:0" - which it is in the default config file) it will find the directory "default:0" if it exists, or "default" if it doesn't (config.fallbackToNoPort is ignored for the default host, it will fallback to no port either way).</p>
				<p>Please note, that is caches all the directorys in the sites directory on boot, so if a directory is added while the server is running, it won't register it. Use the 'jps restart' command to restart the server and thus recache the directorys.</p>
				<p>Then after finding the corresponding directory for the host, it joins the working directory, with sites, the corresponding directory and finally the pathname requested.</p>
				<p>It then stats this new path, if it is a file, it serves the file, if it is a directory, it joins "index.html" to the path and stats that file, if it exists, it serves it. If it isn't a directory and doesn't exist, it adds the extension '.page' and stats this new path. If it is a file, it serves the file. If a file to serve cannot be found, the server responds with a 404 error.</p>
				<p>If the "enableLearning" property of the config file is true, it will store the final served path and link it to the request path, so that next time the same request is recieved, it doesn't have to run the checks. This learning feture can vastly speed up response times so is highly recomended.</p>
			</span>
			
			<h3>Back to the intro! - Finishing the setup and adding your site</h3>
			<p>So, to set up JOTPOT Server, you need a config.json file, a sites directory and idealy a error template file. Luckily, there is a command that can set all this up for you. This is the 'jps setup' command. Basically, this uses the defaultConfig.json and the defaultIndex.html file (both in the archive you extracted to install) to setup a simple server for you. Navigate into the directory you want to setup the server in (use the 'cd' command) and run 'jps setup', as long as there are no errors, the current directory should now have all the files you need for a simple HTTP server, and you can modify them to suit your needs at will and make it as complex as you like.</p>
			<p>So, we have a basic setup, let's add your website. Obviously, if you are running your site as a website for a web browser, the web pages are all writen in HTML (you can write one yourself, or, if you like, there are loads of pieces software out there that will ganerate the HTML for you), after running the setup command, a simple HTML file will have been created for you, you can use this for testing purposes if you like. However, at some point you will need to add your site, you can do it now, or complete the setup and add it afterwards, either way, the instructions still stand.</p>
			<p>Based on the section above about how JOTPOT Server finds files, we know that if we just want out server to serve you site for any hosts, we add it to the default directory ("sites/default" if you haven't changed the config). If you want to host a few sites, on the same server, then you determine the hosts you want to host, I am going to use example.com and example.net for the purpose of illustration, you would set up 2 directorys, one named "example.com" and the other named "example.net" - both within the sites directory. Make sure that the "fallbackToNoPort" property of the config file is true as otherwise it will only look in the directorys with the port numbers, and place each site within their corresponding directorys, and now, when the user connects via example.com, they will be served the content from the example.com directory, and when the user makes a request from the example.net host, it will serve the content from the example.net directory.</p>
			<p>If you want to have different content for example.com for a different port, say "example.com:5" should take the user to a different site, then simply create a directory named "example.com;5" (yes, that is a semi-colon), and when example.com:5 is the host, the server will serve that content, but with any other port, it will serve the content from the example.com directory.</p>
			<p>But let's now say that you want to have 2 different hosts serving the same site, for example example.com and example.jotpot.uk could both be domains for what you want to be the same site, for this, you can use the "hostAlias" property of the config.json file. This is an object, where each key is a host, and it's value it's alias. So if we want both the HTTP version of example.jotpot.uk and the HTTPS version of example.jotpot.uk to serve the same content as example.com, then we would set the value of the hostAlias property to '{"example.jotpot.uk:80": "example.com:80", "example.jotpot.uk:443": "example.com:443"}'. Now example.jotpot.uk will be treated as example.com on both port 80 (default HTTP) and port 443 (default HTTPS).</p>
			<p>However, there is a better way of doing this, the "hostnameAlias" property, although in some cases you only want a specific host to be an alias, in most cases, you will want the hostname to be an alias. If we set the hostnameAlias property to '{"example.jotpot.uk": "example.com"}', then all requests for example.jotpot.uk will be treated as a request for example.com, however the port in the host will not change. So a request for the host example.jotpot.uk:80 would be treated as a request for the host example.com:80 and one for example.jotpot.uk:5 would be treated as one for example.com:5. Please note that the "hostAlias" property is checked first, so to avoid this, you could set example.jotpot.uk:5 to an alias of "example.jotpot.uk:80" (or just example.com:80).</p>
			<p>There are also a couple more properties that relate to hosts, the "hostRedirects" and the "hostnameRedirects" property, these are treated the same as their alias counterparts, however the user is instead redirected to the same URL, but with the alias applied. So if the hostnameRedirects property was '{"example.jotpot.uk": "example.com"}', then when the user requests "example.jotpot.uk/hello/world", they would be redirected to "example.com/hello/world".</p>
			
			<h3>Running the server</h3>
			<p>There are a couple of ways to run the server. The most simple is to just run the 'jps' command in the server directory, this will start up the server in the directory (however it will be in the foreground and not managed my anything, so a crash won't be handled nor the logs stored).</p>
			<p>The second method requires the daemon to be running (I touched upon this in the installation guide, so scroll back up if you need help with that). This is similar to the last method, navigate to the server directory in the terminal, and then run 'jps start', this will instruct the daemon to start the process in the directory you are running the command from. After it is started it will continue running in the background, even when the starting user logs out. It will be stopped only be the user or a system reboot.</p>
			<p>If you want to ensure the server stays up in the case of an unrecoverable error, you can use the -keepalive option (add it at the end of your command), this will cause the daemon to spawn an identicle server if the created one errors - it will have all the same arguments and the same working directory.</p>
			<p>To manage servers under the daemon, there are a few useful commands. First off, is the 'jps list' command, this lists all the servers, their state (either running, errored or stopped), and their working directory.</p>
			<p>Next up, the 'jps stop' and 'jps restart' command. Both of these take one extra argument, this is the ID of the server to perform the action on. So if you were running 'jps stop' you would first run 'jps list' and find the ID of the server you want to stop, then you would run 'jps stop x' where x is the ID of the server. The 'jps stop' command, stops the given server, and 'jps restart' stops it and spawn a new server with all the same flags and working directory (note that the new server will also recieve a new ID).</p>
			<p>You will also probably want to view the logs of the servers, there are curerntly 3 types of logs, 'info', 'error' and 'logs'. The 'info' logs are the logs from the standard output of the server, these are vital logs, such as thread statuses, cacheing errors and config parsing errors, along with anything logs by console.info in the extensions. The 'error' logs are the logs printed from the standard error output, so any fatal errors will be logged here (note that non-fatal, handled errors will be loged to the 'logs' logs). The 'logs' logs are the main server logs, these contain request logging, general info logging and any handled erorrs. The 'logs' logs are however only available when the server is running, this is because to improve speed they are kept in memory owned by the server, and when you request the logs, they are printed to the screen via a socket connecting to the server, the info and error logs on the other hand are available at any time, including ater the process has been stopped or has errored. These logs can be viewed via he 'jps info', 'jps error' and 'jps logs' commands, all of which take the ID as their only argument.</p>
			<p>But wait! I know what you're thinking! Does this mean that I have to run 'jps start' every time I boot up my server, will I have to bother making a unit file for that??? Don't worry, we thought of that too! (And if that wasn't what you were thinking, then I'm sorry, because this is the best we've got.)</p>
			
			<h2>The jps-servers file</h2>
			<p>This file is located at /etc/jps-servers (on most systems) or %PROGRAMDATA%/JOTPOT/jps-servers (on Windows). It is a simple text file, where only LF is used as the new line character (so only "
" rather than "
" as is the default on Windows, sorry if your really Windowsee).</p>
			<p>Each line defines a server that will be automaticaly started as soon as the daemon starts up. Each line is a set of properties seperated by a space, the first property is the working directory of the server, and the rest are arguments to pass to the server. So a jps-servers file might look like this: "/server -keepalive
/home/coolperson/website -keepalive -port 8080". If so, the daemon would create 2 servers, one in the working directory "/server" and with the argument "-keepalive", and the other in the working directory "/home/coolperson/website" with the arguments "-keepalive -port 8080".</p>
			
			<span ID="learning">
				<h3>Learning</h3>
				<p>JOTPOT Server has a feature called learning, it is enabled by the enableLeaning property in the config.json file. It speeds up typcal usage segnificantly.</p>
				<p>When learning is enabled, JPS will remember the file served for a request URL, and thus not have re run the same checks next tiem the request is recieved. An example of this, is when a user requests a directory and the index.html file is served, JPS has to stat the directory to find out that it is a directory, and then stat the index.html file to check it exists. However if learning was enabled, these checks would be run the first time the directory is requested, however subsicent requests made for the directory will be automaticaly served the index.html file without the server having to stat the directory (speeding things up a little). If there are handlers on the page, it will not be learned (to allow the handler to change the URL).</p>
				<p>API functions such as server.unlearn and server.isLeaned can be used for making sure incorrect pages are not learned.</p>
			</span>
			
			<!--
			<p></p>
			<p></p>
			<p></p>
			
			
			
			On windows, you will have to add a firewall exception, and on Linux, if you are creating a server on a privileged port (port number below 1024), you will have to run it as root, so begin the command with sudo - although this isn't recommended, you can set it up so that traffic into port 80 goes to port 8080 for example either on your router or with iptables on Linux, there is a <a href="https://www.cyberciti.biz/faq/linux-port-redirection-with-iptables/" target="_blank">guide from nixCraft here</a>.
			<br>Now, you can load up your browser, and head to http://localhost:&lt;YOUR PORT NUMBER HERE&gt;. This will load up the index.html page in your localhost;&lt;YOUR PORT NUMBER HERE&gt; directory. Then, go to http://localhost:&lt;YOUR PORT NUMBER HERE&gt;/page2.html and you will see your other web page, or go to http://localhost:&lt;YOUR PORT NUMBER HERE&gt;/page3 to see your page3.page file.
			<h3>Going a bit further (just a bit, we haven't even got to extensions yet ;)</h3>
			Now, you can try and access your server from another computer! To do this, find your local IP address, in Linux, use the ifconfig command, work out which interface you are using (mine is eth0, as it is the first eth (ethernet connection), you might be using wlan0 or a separate one) and read off the inet addr value, for example 192.168.1.103. And on windows use the ipconfig command, work out which adapter you are using, mine is the 'Ethernet adapter Ethernet', as mine is an ethernet connection, and read off the IPv4 Address value, again could be something along the lines of 192.168.1.103.
			<br>Remember those numbers. Go to another PC (for now, make sure it is on the same local area network (LAN) as the PC you are using as the server), and open the web browser. No go to http://&lt;YOUR.IP.ADDRESS.HERE&gt;:&lt;YOUR PORT NUMBER HERE&gt; (you don't need to add the :PORT part if you are using port 80 as 80 is the default port for HTTP).
			<br>You will notice that it responds with a 404: Not Found error, this is because it is now looking in 'sites/&lt;YOUR.IP.ADDRESS.HERE&gt;:&lt;YOUR PORT NUMBER HERE&gt;' for index.html, we could solve this be creating a new directory with that name. But we could also use a feature of JOTPOT Server called host aliasing. This allows you to set an alias up for a host, so host-a.com could be processed as host-b.com. We can set this alias in the config.json file. Find the property named "hostAlias". In the default config, the value will be '{}', if we set it to '{"host-a.com":"host-b.com"}', then host-a.com will be handled as host-b.com. This can continue as such: '{"host-a.com":"host-b.com", "some-other-website.co.uk":"some-other-website.com"}'. With a comma separating the values.
			<br>So to set up the alias you want, we can set the "hostAlias" property to '{"&lt;YOUR.IP.ADDRESS.HERE&gt;:&lt;YOUR PORT NUMBER HERE&gt;":"localhost:&lt;YOUR PORT NUMBER HERE&gt;"}'
			<br>Then, reboot the server. So this by focusing on the command window it is running in and pressing ctrl+c to kill the programme. If this doesn't work on Windows (due to changed defaults), just close the window. Then rerun the server and the config.json will be reloaded. Now try from the other computer again and your index.html file should pop up!
			<br><br>To connect to your server from another PC that is not on your network, you will need to know your global IP address, the one that points to you from outside of your LAN. You can get your global IP address from <a href="https://jotpot.co.uk/whatsmyip" target="_blank">jotpot.uk/whatsmyip</a>. You will then need to set up your router to let traffic on your chosen port get to your PC, this is known as port forwarding. Make sure that the port you want to use externally (this could be port 80, the default for HTTP remember or another port), forwards to the port that the server is running on on your PC.
			<br>There are some guides available for setting port forwarding up from: <a href="http://www.pcworld.com/article/244314/how_to_forward_ports_on_your_router.html" target="_blank">PCWorld</a>, <a href="http://www.wikihow.com/Set-Up-Port-Forwarding-on-a-Router" target="_blank">wikiHow</a>, <a href="http://bt.custhelp.com/app/answers/detail/a_id/8790/~/how-do-i-set-up-port-forwarding-on-my-bt-hub?" target="_blank">BT</a>, <a href="https://www.howtogeek.com/66214/how-to-forward-ports-on-your-router/" target="_blank">How-To Geek</a> and many others with <a href="https://www.google.com/search?q=how+to+set+up+a+port+forward" target="_blank">a quick Google search for "how to set up port forwarding"</a> (the How-To Geek one goes in to the most exciting detail)
			<br>Then, you will need to set up another host alias (just as we did before), but this time from &lt;YOUR.GLOBAL.IP.ADDRESS&gt;:&lt;The port you chose to forward from&gt; - remembering that if we chose port 80, we don't need the ':80' at the end. And still to 'localhost:&lt;The port your server is running on&gt;'
			<br>Reboot the server once more and try to connect via your global IP. If all is good, you should be able to access your web server from anywhere in the world now. However you might need to bare in mind that if you have a dynamically assigned IP address, your IP address will change from time to time, so you might need to keep on top of that.
			<br>From there, you can buy a domain name and point that to your IP and turn your website into whatever you like.
			<br>Buying a domain is one way to prevent the constant changing of the host aliases in the config file, but, as mentioned earlier, another way would be to use the default host.
			<br>So for this, lets rename out localhost directory to 'default', this could be anything, but default makes sense. We should then set our "defaultHost" property in the config.json file to the name of our directory. Luckily, the default one you downloaded, already has this. Then make sure that the "useDefaultHostIfHostDoesNotExist" property is set to true, before rebooting the server. You can also remove all the aliases now as they are no longer required.
			<br>After the reboot, no matter what host you use to connect to your server, as long as there isn't a directory for it, it will use the 'sites/default' directory, however if you were to register 2 domains, say "host-a.com" and "host-b.com", you could still have separate directory's for them 'sites/host-a.com' and 'sites/host-b.com', while everything else will go to 'sites/default'.
			<br><br>The rest of the docs dive deeper into JOTPOT Server, it covers the config.json file and also extensions - that give you the power to modify the behaviour of JOTPOT Server and add server-side logic and scripting. Have fun and thank you for using JOTPOT Server :)
			<br><a href="https://github.com/JOTPOT-UK/JOTPOT-Server" target="_blank">JOTPOT Server is all open source on GitHub, so if you encounter any problems, or have any features would like to suggest or add yourself, head over there.</a>
			<br><br>-->
		</div>
		<h2>Command reference</h2>
		<div class="indent">
			<p>JOTPOT Server has 3 commands, these are 'jps', 'jpsd' and 'jpslb'</p>
			
			<h3>The 'jpsd' command</h3>
			<p>Running 'jpsd' is an alias for running 'jps start-daemon'.</p>
			
			<h3>The 'jps' command</h3>
			<p>This is the command used to control the server (not the load balencer).</p>
			<p>It should be used in the format: 'jps [command] [...arguments]'</p>
			<p>If run without a command, it defaults to 'jps run'</p>
			<p><b>Available commands:</b></p>
			<ul>
				<li>error: Prints the stderr of the given server. So 'jps info 5' will print the stderr from server 5.</li>
				<li>info: Prints the stdout of the given server. So 'jps info 5' will print the stdout from server 5.</li>
				<li>list: list lists the servers managed by the daemon, gives a status, either running, errored or stopped, along with their working directory.</li>
				<li>logs: Prints the server logs of the given server. So 'jps info 5' will print the logs from server 5.</li>
				<li>make-unit-file: This generates a systemd unit file that runs the JOTPOT Server daemon based on the current installation.</li>
				<li>restart: restart stops the server given by the first and only argument, and starts one with the same working directory and flags as the one stopped. For example 'jps stop 3' would stop server 3 under the daemon and start a new one with the same working directory and arguments as the one stopped, note that this will start as a new server and thus not share the same ID. (Use 'jps list' to get a list of running servers)</li>
				<li>run: Starts a JOTPOT Server instance in the current working directory. This is bound to the current stdout, stderr and stdin. To stop the server, use control^c to interupt the programme. All given arguments are passed to the server (see the server flga below).</li>
				<li>setup: This sets up the current directory as a simple server. It creates a directory named 'sites', within that, a directory named 'default', and within that a default index.html file. It then creates a simple config.json file and a basic errorTemp.jpt file. After this command is run, the directory can serve as a basic HTTP server listening on port 80.</li>
				<li>start: Instructs the daemon to start a JOTPOT Server instance in the current working directory. Thus once started this instance will run in the background as a child process of the daemon. All given arguments are passed to the server (see the server flga below).</li>
				<li>start-daemon: Starts the daemon.</li>
				<li>stop: stop stops the server given by the first and only argument. For example 'jps stop 3' would stop server 3 under the daemon. (Use 'jps list' to get a list of running servers)</li>
			</ul>
			<p><b>Server flags:</b></p>
			<ul>
				<li>-data: When NOT used under the daemon, this determines the port that the data server listens on.</li>
				<li>-keepalive: When this flag is presant, and the server run under the daemon, if the server crashes, then a new one is started with the same flags and working directory as the current one, to keep it alive.</li>
				<li>-port: Any given port options will be listened on via HTTP, multiple options may be given, for example 'jps start -port 8080 8081 8082 -port 8083', will listen on ports 8080-8083 inclusive.</li>
			</ul>
		</div>
		<h2>The config.json file</h2>
		<span class="indent">This JSON file contains the basic configuration for JOTPOT Server. There are simple versions and demo versions available from <a href="/server">jotpot.co.uk/server</a>. Please note that extensions can modify properties in the server.config object, this will have the effect on the server, however the file will remoained unchanged unless rwriten implicitly.</span>
		<div class="indent">
			Properties:
				<br>
				<br>'addVarsByDefault': Boolean, true to replace anything served in the format "$:::&lt;var name&gt;:::$" with the value of the variable or false to not replace be default.
				<br>'behindLoadBalencer': Boolean. true if headers set be the JOTPOT Server load balencer should be used, for example when determining the source IP address or if the request was HTTPS.
				<br>'cache': Array of Strings. server.cache.cacheFile is called with each item of the array on server boot.
				<br>'controlers': Array of strings. If the array isn't empty, only IP addresses listed in the array are allowed to connect to the data server (this ensures that other divices on the network cannot perform actions on the server).
				<br>'CORS': Array of Arrays. For each item in the array, <a href="#server-addCORSRule">server.addCORSRule</a> is called with the array as the arguments.
				<br>'dataPort': Number||String. The port you would like the server to listen on for data connection (transfering logs and signals), if Number, it listens on 0.0.0.0 on the given port, if it is a string in the format "ip:port", it will listen on the given IP under the given port.
				<br>'defaultHost': String. The host to use by default if the http request contains no host header or useDefaultHostIfHostDoesNotExist is true and the host requested doesn't exist.
				<br>'dontRedirect': Array. When a redirect is considered by the server, it won't redirect if the url value is within this array.
				<br>'doVarsForIfNotByDefault': Array of Strings. Any pages included in this array will have variables added to them even if doing them by default is set to false, they are in the form of the value of the URL (does listen to req.usePortInDirectory, so if the directory name doesn't have a port, than the value shouldn't have the port).
				<br>'errorTemplate': String. The file to use as the error page.
				<br>'enableLearning': Boolean. Whether or not learning should be enabled. See <a href="#learning">learning</a>.
				<br>'fallbackToNoPort': Boolean. If true, when a user makes a request and the host directory doesn't exist, it will try to fall back to the hostname as the driectory (rather than the host). <a href="#how-jotpot-server-serves-files">See 'How JOTPOT Server serves files' for a further description.</a>
				<br>'hostAlias': Object. Similar to hostRedirects however rather then redirecting the server will handle the request as if it came from the host you set - without the user being redirected.
				<br>'hostnameAlias': Object. Similar hostAlias, however only for the hostname.
				<br>'hostnameRedirects': Object. Format: {"host_you_want_redirecting.com": "host_to_redirect_to.com"}, similar to hostAlias, however it only applies the the hostname (so not the port)
				<br>'hostRedirects': Object. Format: {"host_you_want_redirecting.com:xx": "host_to_redirect_to.com:xx"}, when a request is recieved, if the host is a key in this object, the user is redirected to the same URL however with the host changed to the value corresponfing the the key in this object.
				<br>'httpServers': Array. Each item of the array should be an object containing the HTTP server options.
				<br>'httpsServers': Array. Each item of the array should be an object containing the HTTPS server options.
				<br>'mustRedirectToHttps': Array. Similar to redirectToHttps, however the user will be redirected even if they don't request an upgrade - so forces HTTPS (note that the user may not support this).
				<br>'pageAlias': Object. Implemented pre 26A, not currently implemented, use server.cache.createLink from an extension instead. It will be reimplemented soon.
				<br>'redirectToHttps': Array. Each item of the array should be a string of any domains you want to be redirected to the https version of the site if the request requests an upgrade.
				<br>'threads': Number. The number of worker threads the server should start, if 0, so number of CPU cores will be used.
				<br>'useDefaultHostIfHostDoesNotExist': Boolean. true if the default host should be used like an alias if the host the user is requesting does not exist.
				<br>
				<br>HTTP Server Options:
				<br>'port': Number, the port you would like the server to be opened on.
				<br>
				<br>HTTPS Server Options:
				<br>'port': Number, the port you would like the server to be opened on.
		</div>
		<br><br>
		<h2>What are JOTPOT Server extensions and how do they work?</h2>
		<div class="indent">
			JOTPOT Server allows JavaScript files to be run and take control over the server, anything is possible via extensions and 'limited' extensions can be run to ensure an extension can only handle requests etc. from a specific domain/domains for security and stability.
			<br>
			Any file in the working directory of the server, with the full filename ending in '.jpe.js' will be loaded as extensions. There are 2 types of extensions, 'Master' extensions, and 'worker' extensions. JOTPOT Server runs using the 
			<a href="https://nodejs.org/dist/latest-v6.x/docs/api/cluster.html">Node.js cluster modules</a>, 
			this means that there is a master process and then an amount of workers. The master process runs all extensions (where the server.isMaster variable will be true) and each worker runs all the extensions (where the server.isMaster variable is false). 
			They have some shared API features however some different features.
			<br>
			Every extension is loaded with the standard Node.js require function, console object, setTimeout along with the setInterval and setImmediate functions.
			<br>
			There is also a 'server' object for controlling and interacting with the current JOTPOT Server instance, documented below.
			<br>
			The most key consent of extensions is server.handle, and for developing simple applications, it can be all that is needed.
		</div>
		<br><br>
		<span ID="server-object">
			<h2>'server' object</h2>
			<div class="indent">
				<span>The server object is an object available is master and worker extensions, however with differences in each.</span>
				<div ID="server-addCORSRule"><h3 class="func-h3">server.addCORSRule(protocols, host, pathYes, pathNo, allowAllOrigins, allowOrigins, allowMethods[, allowHeaders, exposeHeaders, allowCredentials, priority, maxAge])</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 26A</div><ul class="args-list"><li>protocols &lt;Number&gt; Defines which protocol/protocols this rule applys for. 0 for HTTP only, 1 for HTTPS only, or 2 for any.</li><li>host &lt;String&gt;|&lt;Array&lt;String&gt;&gt; Host that this rule applys to (including port). If host is an array, it applys to all the hosts in the array.</li><li>pathYes &lt;RegExp&gt; The request path must match this RegExp for the rule to apply.</li><li>pathNo &lt;RegExp&gt;|null The request path must NOT match this RegExp for the rule to apply. Note that is must also match pathYes. If null, this is ignored.</li><li>allowAllOrigins &lt;Boolean&gt; If true, all origins will be allowed to access the resource.</li><li>allowOrigins &lt;Array&lt;String|RegExp&gt;&gt; If allowAllOrigins is false, for the origin to be allowed, it will be checked against this array, if it is equal to one of the strings or matches one of the regular expressions, it will be allowed.</li><li>allowMethods &lt;Array&lt;String&gt;&gt; Array of allowed methods, the Access-Control-Allow-Methods header will be set to these methods.</li><li>allowHeaders &lt;Array&lt;String&gt;&gt; Array of allowed headers, the Access-Control-Allow-Headers header will be set to these headers. Defaults to [].</li><li>exposeHeaders &lt;Array&lt;String&gt;&gt; Array of headers that are allowed to be exposed, the Access-Control-Expose-Headers header will be set to these headers. Defaults to [].</li><li>allowCredentials &lt;Boolean&gt; If true, the Access-Control-Allow-Credentials header will be set tp true, if false, it will not be set at all. This header should be false unles credentials are required to load the resource. Defaults to false.</li><li>priority &lt;Number&gt; priority must be -1, 0 or 1. Rules with a priority of 1 override those with a priority of 0, and those with priority of 0 override those with a proprity of -1. If 2 rules have the same priority, the rule first set takes priority. Only setting 3 values makes the checks much more efficient, which is important as these checks occur for every request. Defaults to 0.</li><li>maxAge &lt;Number&gt; Maximum time the CORS response can be cached for by the client (Access-Control-Max-Age header is set to the value). Defaults to -1.</li></ul><div class="desc">Adds a rule that followes the rules set out by the arguments.<br>For more information, please see the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS" target="_blank">MDN article on CORS</a> for details on how the CORS protocol works.</div></div><div ID="server-cache"><h3 class="func-h3">server.cache</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 26A</div><ul class="args-list"></ul><div class="desc">Object of function to control the cache and linking system. Docs on the way...</div></div><div ID="server-callFunc"><h3 class="func-h3">server.callFunc(funcName[, ...arguments])</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 25A</div><ul class="args-list"><li>funcName &lt;String&gt; Name of the function to call.</li><li>...arguments Arguments to call the function with.</li></ul><div class="desc">	Calls a function in the master process that was set by <a href="#server-setFunc">server.setFunc()</a> in a master extension.
	<br>
	Returns a promise that resolves with the returned value of the called function.
</div></div><div ID="server-config"><h3 class="func-h3">server.config</h3><div class="details">Availability:<ul><li>Master extention: <span class="supported">Yes</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="notsupported">No</span></li></ul>Added: 25A</div><ul class="args-list"></ul><div class="desc">Object created from the config.json file, used to determine settings during runtime, you can modify it and the changes will be applied.<br>Please note that some changes such as server.config.dataPort are set when JOTPOT Server loads and thus changing them after the initial load will not have any effect. These can however be changed as soon as the extension is loaded as the server is set up after the extensions are loaded.</div></div><div ID="server-createAccountSystem"><h3 class="func-h3">server.createAccountSystem(options)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: Pre 25A</div><ul class="args-list"><li>options &lt;Object&gt; Options to create the account system with.</li></ul><div class="desc">Created an account system with the given options, documentation coming soon.</div></div><div ID="server-createURL"><h3 class="func-h3">server.createURL(opts)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 26A</div><ul class="args-list"><li>opts.host &lt;String&gt; The host of the URL.</li><li>opts.https &lt;Boolean&gt; Whether or not the URL sould be HTTPS.</li><li>opts.path &lt;String&gt; Path of the URL to create the object around.</li><li>opts.slashes &lt;Boolean&gt; Whether or not the URL contains slashes after the protocol.</li></ul><div class="desc">Creates a <a href="#url-object">URL object</a> with the given options and returns it.</div></div><div ID="server-createURLFromString"><h3 class="func-h3">server.createURLFromString(url)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 26A</div><ul class="args-list"><li>url &lt;String&gt; URL to create the object on.</li></ul><div class="desc">Creates a <a href="#url-object">URL object</a> as a parsed version of the URL given.</div></div><div ID="server-getData"><h3 class="func-h3">server.getData(request)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: Pre 25A<br>From 26A onwards, it is segnificatly more efficient if the request has a content-length header and the amount of data to be recieved is thus known.</div><ul class="args-list"><li>request &lt;Server Request&gt; Request to read the data from.</li></ul><div class="desc">Returns a Promise, this Promise resolves with a Buffer that represents the request body.<br>Note that it only rsolves when the request has ended.</div></div><div ID="server-getGlobal"><h3 class="func-h3">server.getGlobal(variableName[, modifying])</h3><div class="details">Availability:<ul><li>Master extention: <span class="supported">Yes</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="supported">Yes</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: Pre 25A</div><ul class="args-list"><li>variableName &lt;String&gt; Name of the variable to retrieve.</li><li>modifying &lt;Boolean&gt; Whether or not the variable is being 'modified'.</li></ul><div class="desc">	Gets a server wide global variable. In the master process, it will resolve instantly.
	<br>
	Returns a Promise, resolves with the value of the global variable.
	<br>
	See also: <a href="#server-setGlobal">server.setGlobal()</a>
</div></div><div ID="server-getMimeType"><h3 class="func-h3">server.getMimeType(filename)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: Pre 25A</div><ul class="args-list"><li>filename &lt;String&gt; The filename to get the mime type of.</li></ul><div class="desc">Returns the mime type of the filename passed.</div></div><div ID="server-getUserID"><h3 class="func-h3">server.getUserID(request, response)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: Pre 25A</div><ul class="args-list"><li>request &lt;Server Request&gt; The request object to get the user ID from.</li><li>response &lt;Server Response&gt; The response object to get the user ID from.</li></ul><div class="desc">Returns the user ID of the user making this request. If the user doesn't already have a user ID it will create one for it.<br>Note that if it creates a new user ID, the set-cookie header will be set, and overwriting it will cause the user ID to be invalidated.</div></div><div ID="server-handle"><h3 class="func-h3">server.handle(events, callback)</h3><div class="details">Availability:<ul><li>Master extention: <span class="supported">Yes</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="supported">Yes</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: Pre 25A</div><ul class="args-list"><li>events &lt;Array&lt;String&gt;|String&gt; An event or array of events this function should handle.</li><li>callback &lt;Function&gt; Function to call to handle the event.</li></ul><div class="desc">Setting a handle for an event allows the function to overwrite or add to the default behavior for the event being handled.
	<br>
	The function should return undefined, a Boolean or a promise - that should resolve with undefined or a Boolean.
	<br>
	If the function returns true or the returned promise resolves true then the server will consider the event 'handled' and thus not continue with the default behavior<br>All the events that can be handles are detailed in the <a href="#using-server-events">Server Events section.</a></div></div><div ID="server-handlePage"><h3 class="func-h3">server.handlePage(url, handler, incSearch)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 26A</div><ul class="args-list"><li>url &lt;String&gt; The URL that this handler applies to.</li><li>handler &lt;Function&gt; Function to call when the page is requested.</li><li>incSearch &lt;Boolean&gt; Whether or not this URL must match the search of the URL as well.</li></ul><div class="desc">The handler function will be called when the URL that matches the URL string is requested. The function will recieve 2 arguments, request and response - which are for the request that is requesting the page. It may return a boolean or a promise. If a promise is returned, it should resolve with a boolean. If the returned/resolved boolean is true, the server takes the request as handled and thus stops processing it (so it is the handlers responsibility to write the head, body and to end the response). If false is returned/resolved however, the server continues as normal, however taking into account any propertues the habdler may have changed, such as a change in the URL, or an added header value.<br>URL should be in the form 'hostname:port/pathname', if incSearch is true, then the URL may contain a search (so end in ?test=test for example) and that handler will only apply to that search. Also, the port is only included if request.usePortInDirectory is true - see the default behavior for that.</div></div><div ID="server-handleWebSocket"><h3 class="func-h3">server.handleWebSocket(url, handler, incSearch)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 26B</div><ul class="args-list"><li>url &lt;String&gt; The URL that this handler applies to.</li><li>handler &lt;Function&gt; Function to call when an upgrade is requested for the URL.</li><li>incSearch &lt;Boolean&gt; Whether or not this URL must match the search of the URL as well.</li></ul><div class="desc">The handler function will be called when a websocket upgrade request is recieved for the URL that matches the URL string given. The function will recieve a <a href="#wsrequest-object">wsrequest object</a> as the only argument. See <a href="ws-intro">WebSockets in JOTPOT Server</a>.</div></div><div ID="server-implementMethod"><h3 class="func-h3">server.implementMethod(method, checker, handler)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="notsupported">No</span></li></ul>Added: 26A</div><ul class="args-list"><li>method &lt;String&gt; The method that the checker and handler implement, not case sensitive.</li><li>checker &lt;Function&gt; Function that checks if the handler can handle the request/response.</li><li>handler &lt;Function&gt; Function to call to handle the method request.</li></ul><div class="desc">server.implementMethod allows an extension to implement or reimplement a HTTP method. Calling the function with the checker and handler functions binds it to that method, then, when the server recieves a request using that method, or an options request. The checker function is called with the request and response object. If it returns true (note that a Promise cannot be returned), then this handler is allowed to handle the request. This allows for multiple implementations of the same method, however if each implementation only returns true for say cirtain paths, or a request with sepcific headers, or it reads the CORS headers on the response object, then different implementations can coexist. If the request is an options request, and a single checker for a method has returned true, the rest are not checked and the method listed in the allow header. If it is a request, then the handler function is called with the request and response object. The handler may return a Boolean or a Promise that resolves with a Boolean. If this returned/resolved Boolean is true, the server considers the handler as having handled the request, otherwise, the server continues as usaual, checking links, page handlers, caches and files for a response.</div></div><div ID="server-isHandled"><h3 class="func-h3">server.isHandled(url, incSearch)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 26A</div><ul class="args-list"><li>url &lt;String&gt; The URL to see if it is handled.</li><li>checkLevel &lt;Boolean&gt; Whether or not the search is included.</li></ul><div class="desc">Checks if the server has a handler set up for the given URL (in the form host/path), returns a boolean with the result.</div></div><div ID="server-isWebSocketHandled"><h3 class="func-h3">server.isWebSocketHandled(url, incSearch)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 26B</div><ul class="args-list"><li>url &lt;String&gt; The URL to see if it is handled.</li><li>checkLevel &lt;Boolean&gt; Whether or not the search is included.</li></ul><div class="desc">Checks if the server has a handler set up for a WebSocket upgrade request for the given URL (in the form host/path), returns a boolean with the result.</div></div><div ID="server-isLearned"><h3 class="func-h3">server.isLearned(url, checkLevel)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 26A</div><ul class="args-list"><li>url &lt;String&gt; The URL to see if it is learned.</li><li>checkLevel &lt;Number&gt; If not 0, all searches will be checked.</li></ul><div class="desc">Checks if the server has learned behavior for the given URL (in the form host/path), returns a boolean with the result. If check level is 0, the learned value must be the exact URL. Otherwise, it will return true if any search values of the URL or the URL itself is learned.</div></div><div ID="server-limited"><h3 class="func-h3">server.limited</h3><div class="details">Availability:<ul><li>Master extention: <span class="supported">Yes</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="supported">Yes</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: Pre 25A</div><ul class="args-list"></ul><div class="desc">	true if the extension is limited, false if not.
</div></div><div ID="server-loadExt"><h3 class="func-h3">server.loadExt(path[, lock])</h3><div class="details">Availability:<ul><li>Master extention: <span class="supported">Yes</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="notsupported">No</span></li></ul>Added: Pre 25A<br>Notes: Available in limited extensions until 25D</div><ul class="args-list"><li>path &lt;String&gt; Path of the file to run.</li><li>lock &lt;Lock&gt; Optional lock to apply to the extension.</li></ul><div class="desc">	Loads and runs the path given as an extension. If a lock argument is given, that lock will be applied to the extension. Use the <a href="#server-lock">server.lock</a> class to create a valid lock.
	<br>
	If the current extension is a master extension, the new extension will be loaded as a master extension and if the extension is a worker extension the new extension will also be loaded as a worker extension, only in the process of the current extension - so to ensure an extension can handle all server events it must be loaded all times its parent extension is loaded.
</div></div><div ID="server-lock"><h3 class="func-h3">new server.lock([variableSandbox, mode, hosts])</h3><div class="details">Availability:<ul><li>Master extention: <span class="supported">Yes</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="notsupported">No</span></li></ul>Added: 25A<br>Note: From 25D the server.lock is actually an extension of the actually lock class to prevent it from being overwritten and causing errors.</div><ul class="args-list"><li>variableSandbox &lt;String|null&gt; Name of sandbox to use for global variables, or null if no sandbox.</li><li>mode &lt;Number&gt; Optional lock to apply to the extension.</li><li>hosts &lt;Array&lt;String&gt;&gt; Array of strings this extension is allowed to handle events for.</li></ul><div class="desc">	If variableSandbox is a string, all server wide global variables set with <a href="#server-setGlobal">setGlobal</a> and retrieved with <a href="#server-getGlobal">getGlobal</a> (or <a href="#server-modGlobal">modGlobal</a>) will be stored within an object named 'variableSandbox' within the standard global object - meaning that the extension cannot access global variables from other extensions with no or different sandboxes, however extensions with no sandbox can access the variables be getting the global variable named 'variableSandbox' - which will be an object of the variables.
	<br>
	If host limits are used (so mode &gt;= 1), the extension will only be allowed to handle events for that domain, so if 'hosts' is ["www.example.com"], then any handles created by it for "request" or similar events will only handle these events for requests to "www.example.com", so it will not be allowed to handle events for "www.jotpot.co.uk".
	<br>
	Mode can only be 0, 1 or 2 (defaults to 2). If mode is 0, only the variable sandbox will be applied, if mode is 1, variable sandbox will be applied and the host limits will be applied, mode 2 behaves identically to mode 1 right now however new behavior will be added in the future for mode 2.
	<br>
	The object created should be used when calling <a href="#server-loadExt">server.loadExt()</a>
</div></div><div ID="server-modGlobal"><h3 class="func-h3">server.modGlobal(variableName)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 25B</div><ul class="args-list"><li>variableName &lt;String&gt; Name of the variable to modify.</li></ul><div class="desc">	Same as calling <a href="#server-getGlobal">server.getGlobal(variableName, true)</a>
</div></div><div ID="server-multiPartFormDataParser"><h3 class="func-h3">server.multiPartFormDataParser(request, callback)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 25E<br>Note: Not currently recomended due to lack of testing.</div><ul class="args-list"><li>request &lt;Server Request&gt; Request to parse the data from.</li><li>callback &lt;Function&gt; Function to be called with all new data.</li></ul><div class="desc">Returns a Promise, that resolves when all data has been recieved and parsed.<br>The callback is called whenever a new field is recieved. It is sent with a Data class as the only argument.<br>The Data class is an extension of the standard Node.js readable stream and the data recieved for the current field will be piped out of it. It also has 3 extra popities: name, headers and setup. The name property contains the name of the field, headers contains an object of the parsed headers of the field, and setup is used for internal use.</div></div><div ID="server-pages"><h3 class="func-h3">server.pages</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="notsupported">No</span></li></ul>Added: Pre 25A</div><ul class="args-list"></ul><div class="desc">	Variables used for caching, documentation coming soon.
</div></div><div ID="server-reloadConfig"><h3 class="func-h3">server.reloadConfig()</h3><div class="details">Availability:<ul><li>Master extention: <span class="supported">Yes</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="notsupported">No</span></li></ul>Added: 25A<br>Note: Not available in the master process until 25D</div><ul class="args-list"></ul><div class="desc">Reloads the config.json file.</div></div><div ID="server-removePageHandler"><h3 class="func-h3">server.removePageHandler(url, handler, incSearch)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 26A</div><ul class="args-list"><li>url &lt;String&gt; The URL that the handler you want to remove is for.</li><li>incSearch &lt;Boolean&gt; Whether or not the handler you want to remove was set with incSearch as true.</li></ul><div class="desc">The handler function will be called when the URL that matches the URL string is requested. The function will recieve 2 arguments, request and response - which are for the request that is requesting the page. It may return a boolean or a promise. If a promise is returned, it should resolve with a boolean. If the returned/resolved boolean is true, the server takes the request as handled and thus stops processing it (so it is the handlers responsibility to write the head, body and to end the response). If false is returned/resolved however, the server continues as normal, however taking into account any propertues the habdler may have changed, such as a change in the URL, or an added header value.<br>URL should be in the form 'hostname:port/pathname', if incSearch is true, then the URL may contain a search (so end in ?test=test for example) and that handler will only apply to that search. Also, the port is only included if request.usePortInDirectory is true - see the default behavior for that.</div></div><div ID="server-sendCache"><h3 class="func-h3">server.sendCache(file, response, request)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="notsupported">No</span></li></ul>Added: 25E<br>Before 26A, the request object was optional as it was only used for logging.</div><ul class="args-list"><li>file &lt;String&gt; URL to send coresponding cache for.</li><li>cache &lt;String&gt;|&lt;Buffer&gt; Data to send.</li><li>response &lt;Server Response&gt; The response to send the error to.</li><li>request &lt;Server Request&gt; The corresponding request, used for range headers and request tracking.</li><li>status &lt;Number&gt; Optional, the status code to send, defaults to 200.</li></ul><div class="desc">Exposes an internal function that has been around scince the first release.<br>server.sendCache sends a cache to the response. The cache argument is writen to the response into Node.js's <a href="">response.write</a>, so any type that can be writen to that will be acceptable as the cache argument.<br>The code argument specifies the response code to be sent.<br>Returns a promise that rejects on an unexpected error, and resolves with an array. Index 0 of this array is a boolean, true if the response was sent succesfully and false if not. If index 0 is false, index 1 is the error.<br>Chunked encoding is used unless there are no pipes, in which case the content-length header will be set the the length property of the cache argument.<br>From 26A onwards, the range headers are used, allowing the server to send 206 responses.</div></div><div ID="server-sendError"><h3 class="func-h3">server.sendError(code, message, response, request)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="notsupported">No</span></li></ul>Added: Pre 25A</div><ul class="args-list"><li>code &lt;Number&gt; HTTP response code to send.</li><li>message &lt;String&gt; The message to display on the error page.</li><li>response &lt;Server Response&gt; The response to send the error to.</li><li>request &lt;Server Request&gt; Optional, the corresponding request, used for logging purposes.</li></ul><div class="desc">Sends a full response based on the error code with the 'errorTemp.jpt' file (from the working directory of the server) with all the error details.</div></div><div ID="server-sendFile"><h3 class="func-h3">server.sendFile(file, response, request)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="notsupported">No</span></li></ul>Added: 25E</div><ul class="args-list"><li>file &lt;String&gt; URL to send coresponding file for.</li><li>response &lt;Server Response&gt; The response to send the error to.</li><li>request &lt;Server Request&gt; Optional, the request to get the ID from for improved logging.</li></ul><div class="desc">Exposes an internal function that has been around scince the first release.<br>server.sendFile sends the correct file as the response to the request. For example if file is 'example.com/hello.html', it will serve './sites/example.com/hello.html'.<br>Returns a promise that rejects on an unexpected error, and resolves with an array. Index 0 of this array is a boolean, true if the response was sent succesfully and false if not. If index 0 is false, index 1 is the error.<br>It pipes through all the correct pipes, including the vars pipe if it should be added for the file given. Chunked encoding is used unless there are no pipes, in which case the content-length header is set to the size of the file being served.<br>From 26A onwards, the range headers are used, allowing the server to send 206 responses.</div></div><div ID="server-setFunc"><h3 class="func-h3">server.setFunc(functionName, function)</h3><div class="details">Availability:<ul><li>Master extention: <span class="supported">Yes</span></li><li>Worker extention: <span class="notsupported">No</span></li><li>Limited master extention: <span class="supported">Yes</span></li><li>Limited worker extention: <span class="notsupported">No</span></li></ul>Added: 25A</div><ul class="args-list"><li>functionName &lt;String&gt; Name of the function to set.</li><li>function &lt;Function&gt; The function to assign to the function name.</li></ul><div class="desc">Sets a function that can be called by any of the workers via <a href="#server-callFunc">server.callFunc()</a>. Each seperate lock gets its own scope for functions - based on the variable scope.</div></div><div ID="server-setGlobal"><h3 class="func-h3">server.setGlobal(variableName, value)</h3><div class="details">Availability:<ul><li>Master extention: <span class="supported">Yes</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="supported">Yes</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: Pre 25A</div><ul class="args-list"><li>variableName &lt;String&gt; Name of the variable to retrieve.</li><li>value Value to set the variable to.</li></ul><div class="desc">	Sets a server wide global variable. In the master process, it will resolve instantly.
	<br>
	Returns a Promise, resolves when the value of the variable has been set.
	<br>
	See also: <a href="#server-getGlobal">server.getGlobal()</a>
</div></div><div ID="server-unlearn"><h3 class="func-h3">server.unlearn(url, level)</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="supported">Yes</span></li></ul>Added: 26A</div><ul class="args-list"><li>url &lt;String&gt; The URL to see if it is learned.</li><li>checkLevel &lt;Number&gt; If not 0, all searches will be removed also.</li></ul><div class="desc">If level is 0, removes the learning links for the exact URL, otherwise it removes all learing links for that page and all it's searches.</div></div><div ID="server-vars"><h3 class="func-h3">server.vars</h3><div class="details">Availability:<ul><li>Master extention: <span class="notsupported">No</span></li><li>Worker extention: <span class="supported">Yes</span></li><li>Limited master extention: <span class="notsupported">No</span></li><li>Limited worker extention: <span class="notsupported">No</span></li></ul>Added: Pre 25A</div><ul class="args-list"></ul><div class="desc">	Object containing global variables to be inserted into pages.
	<br>
	If server.vars = {'test1':'hi','test2':'world'}, then in a page served containing the contents '$:::test1:::$ - $:::test2:::$' will be served as 'hi - world'.
	<br>
	Note that <a href="#response-vars">ServerResponse.vars</a> will also be added this way, with a higher priority (with a lower priority until 25D).
</div></div>
			</div>
		</span>
		<br><br>
		<span ID="using-server-events">
		<h2>
			Server Events
		</h2>
		<div class="indent">
			JOTPOT Server has a serese of events that extensions can handle to add behavior to or to overwrite the behavior of.
			<br>
			Please see <a href="#server-handle">server.handle()</a> for handling events.
			<br>
			<h3>
				Events:
			</h3>
			<ul>
				<li>'ready' event: This is the first event to fire, this event is fired when the current process is up and ready. This is fired for both master extensions and worker extensions and is the only event currently for master extensions. It cannot be overwritten, so the return value is ignored. The handler is called with no arguments.</li>
				<li>'request' event: This event is fired whenever a request is received, this event is fired before any redirects happen, such as redirects to HTTPS or redirects to the login page, so this should generally not be handled. The default behavior can be overwritten to if the handler returns true or returns a promise that resolves true, JOTPOT Server will stop handling the request. The handler is called with 2 arguments, the request object and the response object.</li>
				<li>'&lt;domain&gt;/request' event: This is the equivalent to the 'request' event however only fires for the domain before the '/'</li>
				<li>'fullrequest' event: This event is fired after a request is redirected and has page/host aliases applied, this event is however fired before any authentication checks happen, so this should generally not be handled if an account system is active of the page. The default behavior can be overwritten to if the handler returns true or returns a promise that resolves true, JOTPOT Server will stop handling the request. The handler is called with 2 arguments, the request object and the response object.</li>
				<li>'&lt;domain&gt;/fullrequest' event: This is the equivalent to the 'fullrequest' event however only fires for the domain before the '/'</li>
				<li>'allowedrequest' event: This event is fired when the server is ready to respond to the event, the user will have gone through all redirects, any aliases will have been applied and the user will be authenticated to access the page they are requesting. In most cases, this is the best event to handle for server side rendering, analytics and most other use cases.</li>
				<li>'&lt;domain&gt;/allowedrequest' event: This is the equivalent to the 'allowedrequest' event however only fires for the domain before the '/'</li>
				<li>'websocket' event: This event is fired when the server recieves a request to upgrade to the websockets protocol. Any callbacks are called with 1 argument, that is a websocket request object (call the accept method to get the response object).</li>
				<li>'&lt;domain&gt;/websocket' event: This is the equivalent to the 'websocket' event however only fires for the domain before the '/'</li>
			</ul>
		</div>
		<br><br>
			<h2>
				Using server.handle
			</h2>
			<div class="indent">
				So, lets say you want to render a page serverside for the user, you could use the serveer.handle function to create this functionality.
				<br>
				When you handle any request event, so 'request', 'fullrequest', 'allowedrequest' or any host specific request, the handler function will receive 2 arguments, the request and the response object. These are documented below.
				<br>
				Here is an example:
				<pre>
				//Handle the request when we know it is allowed, to ensure that
				// we don't serve a page to a user that isn't logged in.
				server.handle('allowedrequest', (req, resp) => {
					
					//The request and response object have everything the standard
					// Node.js objects have however with some modified properties
					// and some additional ones.
					
					//Note how the domain is at the start of the req.url, see
					// req.url in the request docs below for how it is different.
					// You might also want to use req.purl here instead.
					if (req.url === 'www.exmaple.com/content.html') {
						
						//Call you own function to hamdle the request and the
						// response as you would in any other Node.js server.
						renderContentPage(req, resp) ;
						
						//Return true to say that this has handled the event
						// so the default behavior gets overwritten.
						return true ;
						
					}
					
					//If we haven't handled it, return false so the server 
					// continues with the default behavior for the request.
					return false ;
					
				});
				</pre>
			</div>
		</span>
		<br>
		<span ID="request-object">
			<h2>
				The 'request' ('IncomingMessage') object.
			</h2>
			<div class="indent">
				The 'request' object is passed as the first argument to any hander function handling a request - with the second argument always been the response object. It is the <a href="https://nodejs.org/dist/latest-v6.x/docs/api/http.html#http_class_http_incomingmessage">Node.js IncomingMessage object</a> however has some modified properties and some added properties to make working with it easier. All of these changed/additional properties are listed below.
			</div>
			<div class="indent">
			<div ID="request-ip"><h3 class="func-h3">request.ip</h3><div class="details">Added: 25E</div><ul class="args-list"></ul><div class="desc">request.ip if the IP address of the user making the request. If there is an x-forwarded-for header, the IP address is set the that over the accual IP address.<br>If config.behindLoadBalancer is true, the jp-source-ip header set by the load balancer will be used as the source IP.<br>Also see <a href="#request-remoteAddress">request.remoteAddress</a>.</div></div><div ID="request-orig_url"><h3 class="func-h3">request.orig_url</h3><div class="details">Added: Pre 25A<br>Note that before 26A this was the initial string value of request.url</div><ul class="args-list"></ul><div class="desc">This is the initial value of the request.url object.</div></div><div ID="request-overHttps"><h3 class="func-h3">request.overHttps</h3><div class="details">Added: Pre 25A<br>Note that before 26A, it did not check or set req.url in any way.</div><ul class="args-list"></ul><div class="desc">Boolean that represents if the request was made over HTTPS. When changed, request.value.protocol will be changed to the https: if it is set to true or http: if it is set to false. This change only occurs if the user hasn't set it to a protocol such as ftp:. When getting the value, it checks request.url.protocol and if it is https: or sftp: it returns true, else, false.<br>If there is another protocol you would like to make appear as secure, just post an issue or create a pull request on <a href="https://github.com/JOTPOT-UK/JOTPOT-Server" target="_blank">GitHub</a> adding the protocol to the secureProtocols array.<br>If config.behindLoadBalencer is true, it will be set dependent on the load balencer headers.</div></div><div ID="request-purl"><h3 class="func-h3">request.purl</h3><div class="details">Added: 25A<br>Removed in 26A as the request.url object has all of these properties.</div><ul class="args-list"></ul><div class="desc">Equivalent to if request.fullurl was passed to <a href="https://nodejs.org/dist/latest-v6.x/docs/api/url.html">Node.js's url.parse</a>.</div></div><div ID="request-secure"><h3 class="func-h3">request.secure</h3><div class="details">Added: 25D</div><ul class="args-list"></ul><div class="desc">Alias for <a href="#request-overHttps">request.overHttps</a>.<!--Whether or not the request and response is secure, so true if the request was made over HTTPS and false if not.<br>From 25E onwards, if config.behindLoadBalancer is true, the jp-source-secure header set by the load balancer will be set, even if the load balancer made the request via HTTP to the server, the value will be determined by the clients connection to the load balancer.--></div></div><div ID="request-secureToServer"><h3 class="func-h3">request.secureToServer</h3><div class="details">Added: 25D</div><ul class="args-list"></ul><div class="desc">Whether or not the connection from the load balancer to the server is HTTPS. If there is no load balancer, it is equal to <a href="#request-secure">request.secure</a></div></div><div ID="request-remoteAddress"><h3 class="func-h3">request.remoteAddress</h3><div class="details">Added: 25E</div><ul class="args-list"></ul><div class="desc">request.remoteAddress if the IP address of the client making the request. Unlike <a href="#request-ip">request.ip</a>, it ignores the x-forwarded-for header.<br>If config.behindLoadBalancer is true, the jp-source-ip header set by the load balancer will be used as the source IP.</div></div><div ID="request-uri"><h3 class="func-h3">request.uri</h3><div class="details">Added: 26A</div><ul class="args-list"></ul><div class="desc">This sets/gets the URI from the request body. So for example if the first line of the request is 'GET /hello/world?test=ok HTTP/1.1', then request.URI will be '/hello/world?test=ok'. When set, it will modify the request.url object and when the request.url object is modified, this will be modified.</div></div><div ID="request-url"><h3 class="func-h3">request.url</h3><div class="details">Added: Pre 25A<br>Notes:<br>Before 1.2.0, request.url was all lower case.<br>Before 26A, request.url was the same as the current request.url.fullvalue. So was a string, rather than an object.</div><ul class="args-list"></ul><div class="desc">This is a JOTPOT Server <a href="#url-object">URL object</a> that represents the URL that was requested by the client.<br>Limited extensions may not change the host of the request.url object. Between the request event and the fullrequest event, the pathname property has all occurences of '..', double slashes and any trailing slashes removed.</div></div><div ID="request-usePortInDirectory"><h3 class="func-h3">request.usePortInDirectory</h3><div class="details">Added: 26A</div><ul class="args-list"></ul><div class="desc">Boolean, it determines if the port is used when responding the the request. So if the user requests 'www.example.com:80/example.html' and request.usePortInDirectory is true, handlers for 'www.example.com:80/example.html' will be checked, and the file is searches for will be 'www.example.com;80/example.html', however if false, it will check hadlers for 'www.example.com/example.html' and look for the file 'www.example.com/example.html'. Please note that other checks follow these rules, such as links and caching.<br>For the request event, this is set to true every time, then between the request event and the fullrequest event, if config.fallbackToNoPort is true and a directory with the port doesn't exist, request.usePortInDirectory is set to false.<br>So, you can set it to false an any point and have it stick, however if you want to force the value to be true, you must set it after the request event. However if you do this, a 404 response is garenteed as it will only be set to false if the directory doesn't exist.</div></div><div ID="request-user"><h3 class="func-h3">request.user</h3><div class="details">Added: Pre 25A</div><ul class="args-list"></ul><div class="desc">This is the user ID of the user of the current user, please note that this is only set when it is required for the user to be authenticated for the page. And thus also only available in the allowedrequest handle and is not garenteed to be available.</div></div>
			</div>
		</span>
		<br><br>
		<span ID="response-object">
			<h2>
				The 'response' ('ServerResponse') object.
			</h2>
			<div class="indent">
				The 'response' object is always passed to the request hander as the second argument, and similar to the 'request' object is the <a href="https://nodejs.org/dist/latest-v6.x/docs/api/http.html#http_class_http_serverresponse">Node.js ServerResponse object</a> however with a couple of added properties for ease of use. These added properties are documented below.
			</div>
			<div class="indent">
			<div ID="response-forceDownload"><h3 class="func-h3">response.forceDownload</h3><div class="details">Added: 26A</div><ul class="args-list"></ul><div class="desc">Boolean, if true, the mime type application/octet-stream will be sent, to force the client to download the resource. Defaults to false.</div></div><div ID="response-pipeThrough"><h3 class="func-h3">response.pipeThrough</h3><div class="details">Added: Pre 25A</div><ul class="args-list"></ul><div class="desc">This is an array that by default is empty. When the response is sent, it will be piped through all the pipes in this array before been piped to the client, meaning that you can add compression transform pipes, some templating solutions or more to this array and your response will be sent through them.</div></div><div ID="response-sendBody"><h3 class="func-h3">response.sendBody</h3><div class="details">Added: 26A</div><ul class="args-list"></ul><div class="desc">Boolean, if false, the response will not contain a body. Used internaly for the default implementation of the head method. However it can be set by extensions.</div></div><div ID="response-vars"><h3 class="func-h3">response.vars</h3><div class="details">Added: Pre 25A</div><ul class="args-list"></ul><div class="desc">These are variables processed in the same way as <a href="#server-vars">server.vars</a> however these are only for the current response and will overwrite any global variables.</div></div>
			</div>
		</span>
		<br><br>
		<span ID="url-object">
			<h2>
				The 'url' object.
			</h2>
			<div class="indent">
				The 'url' object is an object that is used to describe a URL. By default, request.url is a url object representing the request URL.
				<br>You can also create your own url object using <a href="#server-createURL">server.createURL</a> and <a href="#server-createURLFromString">server.createURLFromString</a>.
				<br>An url has a value that is a string, which is the same as the value property, and thus url == url.value however url !== url.value.
				<br>Most of it's properties are setters and getters and thus when one property is changed, the others echo the change. So changing the port proprty will also change the host property, the origin property and etc.
			</div>
			<div class="indent">
				<div ID="url-accualHost"><h3 class="func-h3">url.accualHost</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>//Change the URL in any way<br>url.accualURL === 'https://www.example.com:443/hello/world.html?test=hello#abc'</span><br>This is the origional value of url.href, it is read only so cannot be changed, so for request.url, you can use this to determine what the request was origionaly for.</div></div><div ID="url-auth"><h3 class="func-h3">url.auth</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://user:pass@www.example.com:443/hello/world.html?test=hello#abc'<br>url.auth === 'user:pass'</span><br>The authentification section of the URL, see <a href="#url-username">url.username</a> and <a href="#url-password">url.password</a>.</div></div><div ID="url-fullvalue"><h3 class="func-h3">url.fullvalue</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.fullvalue === 'www.example.com:443/hello/world.html?test=hello#abc'</span><br>Equivilent of url.host + url.path.</div></div><div ID="url-fullvaluenoport"><h3 class="func-h3">url.fullvaluenoport</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.fullvaluenoport === 'www.example.com:443/hello/world.html?test=hello#abc'</span><br>Equivilent of url.hostname + url.path.</div></div><div ID="url-hash"><h3 class="func-h3">url.hash</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.hash === '#abc'</span><br>The hash of the URL.</div></div><div ID="url-host"><h3 class="func-h3">url.host</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.host === 'www.example.com:443'</span><br>The host of the URL, includes the port.</div></div><div ID="url-hostname"><h3 class="func-h3">url.hostname</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.hostname === 'www.example.com'</span><br>The hostname of the URL, do doesn't include the port.</div></div><div ID="url-href"><h3 class="func-h3">url.href</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'</span><br>The full URL, with all the properties.</div></div><div ID="url-hrefnoport"><h3 class="func-h3">url.hrefnoport</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.hrefnoport === 'https://www.example.com/hello/world.html?test=hello#abc'</span><br>Same as <a href="#url-href">url.href</a>, except without the port.</div></div><div ID="url-location"><h3 class="func-h3">url.location</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.location === 'https://www.example.com/hello/world.html?test=hello#abc'<br>url.href === 'http://www.example.com:80/hello/world.html?test=hello#abc'<br>url.location === 'http://www.example.com/hello/world.html?test=hello#abc'<br>url.href === 'http://www.example.com:8080/hello/world.html?test=hello#abc'<br>url.location === 'http://www.example.com:8080/hello/world.html?test=hello#abc'</span><br>Same as <a href="#url-href">url.href</a>, except it doesn't include the port if it is the default port for the protocol, this can be used for redirects, when you want to send the user to a location, but obviously, you don't want the port in their URL bar.</div></div><div ID="url-lockHost"><h3 class="func-h3">url.lockHost()</h3><div class="details"></div><ul class="args-list"></ul><div class="desc">Calling this function locks the host, so it cannot be changed. It returns a function that when called unlocks the host. If the host is locked, calling the function has ne effect and the returned function also has no effect.</div></div><div ID="url-origin"><h3 class="func-h3">url.origin</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.origin === 'https://www.example.com:443'</span><br>The origin of the URL.</div></div><div ID="url-password"><h3 class="func-h3">url.password</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://user:pass@www.example.com:443/hello/world.html?test=hello#abc'<br>url.password === 'pass'</span><br>The password section of <a href="#url-auth">url.auth</a>.</div></div><div ID="url-path"><h3 class="func-h3">url.path</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.path === '/hello/world.html?test=hello'</span><br>The path of the URL.</div></div><div ID="url-pathname"><h3 class="func-h3">url.pathname</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.pathname === '/hello/world.html'</span><br>The pathname of the URL.</div></div><div ID="url-port"><h3 class="func-h3">url.port</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.port === '443'</span><br>The port from the host of the URL.</div></div><div ID="url-protocol"><h3 class="func-h3">url.protocol</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.protocol === 'https:'</span><br>The protocol of the URL.</div></div><div ID="url-query"><h3 class="func-h3">url.query</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.query === 'test=hello'</span><br>The search query of the URL.</div></div><div ID="url-search"><h3 class="func-h3">url.search</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.search === '?test=hello'</span><br>The search query of the URL, with the ?.</div></div><div ID="url-slashes"><h3 class="func-h3">url.slashes</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.slashes === true</span><br>Whether or not the URL contains slashes after to protocol.</div></div><div ID="url-username"><h3 class="func-h3">url.username</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://user:pass@www.example.com:443/hello/world.html?test=hello#abc'<br>url.username === 'user'</span><br>The username section of <a href="#url-auth">url.auth</a>.</div></div><div ID="url-value"><h3 class="func-h3">url.value</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.value === 'www.example.com:443/hello/world.html'</span><br>Equivilent of url.host + url.pathname.</div></div><div ID="url-valuenoport"><h3 class="func-h3">url.valuenoport</h3><div class="details"></div><ul class="args-list"></ul><div class="desc"><span class="urlcode">url.href === 'https://www.example.com:443/hello/world.html?test=hello#abc'<br>url.valuenoport === 'www.example.com/hello/world.html'</span><br>Equivilent of url.hostname + url.pathname.</div></div>
			</div>
		</span>
		<br><br>
		<span ID="ws-intro">
			<h2>
				WebSockets in JOTPOT Server
			</h2>
			<div class="indent">
				<p>WebSockets is an incredably powerful tool in developing web apps, and from JOTPOT Server 26B onwards, support for it is built in.</p>
				<h3>A quick intro to WebSockets</h3>
				<p>WebSockets is a protocol that can be used by JavaScript in a browser to start a session with the server, either the client or the server can then send messages to eachother at any time. WebSockets is fast keeps the socket open, meaning that there is minimal latency, and the server can send messages to the client at any time without having to be polled.</p>
				<p>You can read more about the WebSockets protocol and see the browser API reference at <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API" target="_blank">developer.mozilla.org/en-US/docs/Web/API/WebSockets_API</a>.</p>
				<h3>Using WebSockets in JOTPOT Server</h3>
				<p>When a WebSockets session is started, a HTTP Upgrade request is send by the client, requesting to be upgraded to WebSockets, when JOTPOT Server recieves one of these requests, it triggers the 'websocket' event. By using <a href="#server-handle">server.handle</a> you can add your behavior for all WebSocket upgrade requests, or you can use </p>
				<p></p>
				<p></p>
			</div>
		</span>
		<br><br>
		<span ID="wsrequest-object">
			<h2>
				The 'wsrequest' object.
			</h2>
			<div class="indent">
				<p>This object is used to represent the WS upgrade request and all incoming WS messages.</p>
				<p>It is an event emmiter that emits events for recieved messages, it containes information about the HTTP request for the upgrade (such as headers, version etc.), the socket for the connection and some methods used to control the WebSockets session.</p>
				<p>The most important method being wsrequest.accept, this accepts the upgrade request and generates the wsresponse object, so at the start of any WebSockets session wsrequest.accept() must be called. See the documentation on it for more details.</p>
			</div>
			<div class="indent">
				<h3>Events:</h3>
				<p>'text': Emited when a text message is recieved, the callback recieves the text message as a string as the only argument.</p>
				<p>'binary': Emited when a binary message is recieved, the callback recieves the binary message as a Buffer as the only argument.</p>
			</div>
			<div class="indent">
				<div ID="wsrequest-accept"><h3 class="func-h3">wsrequest.accept(callback)</h3><div class="details">Added: 26B</div><ul class="args-list"><li>callback &lt;Function&gt; Function to call once the upgraded, it is given 2 arguments, the first either error or null, and the second is the corresponding wsresponse object (or null of there was an error).</li></ul><div class="desc">wsrequest.accept accepts the upgrade request to websockets, so for a websockets session to start, accept must be called. It returns undefined and the callback is called once the upgrade has been accepted, the callback recieves 1 argument, this is the corresponding wsresponse object.</div></div><div ID="wsrequest-destroy"><h3 class="func-h3">wsrequest.destroy([error])</h3><div class="details">Added: 26B</div><ul class="args-list"></ul><div class="desc">See the <a href="https://nodejs.org/dist/latest-v6.x/docs/api/http.html#http_message_destroy_error" target="_blank">Node.js documentation</a>.</div></div><div ID="wsrequest-end"><h3 class="func-h3">wsrequest.end([data][, encoding])</h3><div class="details">Added: 26B</div><ul class="args-list"></ul><div class="desc">Same as <a href="https://nodejs.org/dist/latest-v6.x/docs/api/net.html#net_socket_end_data_encoding" target="_blank">wsrequest.socket.end</a></div></div><div ID="wsrequest-headers"><h3 class="func-h3">wsrequest.headers</h3><div class="details">Added: 26B</div><ul class="args-list"></ul><div class="desc">An object representing the HTTP headers of the upgrade request. (In key-value pairs)</div></div><div ID="wsrequest-httpVersion"><h3 class="func-h3">wsrequest.httpVersion</h3><div class="details">Added: 26B</div><ul class="args-list"></ul><div class="desc">See the <a href="https://nodejs.org/dist/latest-v6.x/docs/api/http.html#http_message_httpversion" target="_blank">Node.js documentation</a>.</div></div><div ID="wsrequest-httpVersionMajor"><h3 class="func-h3">wsrequest.httpVersionMajor</h3><div class="details">Added: 26B</div><ul class="args-list"></ul><div class="desc">See the <a href="https://nodejs.org/dist/latest-v6.x/docs/api/http.html#http_message_httpversion" target="_blank">Node.js documentation</a>.</div></div><div ID="wsrequest-httpVersionMinor"><h3 class="func-h3">wsrequest.httpVersionMinor</h3><div class="details">Added: 26B</div><ul class="args-list"></ul><div class="desc">See the <a href="https://nodejs.org/dist/latest-v6.x/docs/api/http.html#http_message_httpversion" target="_blank">Node.js documentation</a>.</div></div><div ID="wsrequest-rawHeaders"><h3 class="func-h3">wsrequest.rawHeaders</h3><div class="details">Added: 26B</div><ul class="args-list"></ul><div class="desc">See the <a href="https://nodejs.org/dist/latest-v6.x/docs/api/http.html#http_message_rawheaders" target="_blank">Node.js documentation</a>.</div></div><div ID="wsrequest-socket"><h3 class="func-h3">wsrequest.socket</h3><div class="details">Added: 26B</div><ul class="args-list"></ul><div class="desc">The socket coresponding to the request.</div></div><div ID="wsrequest-url"><h3 class="func-h3">wsrequest.url</h3><div class="details">Added: 26B</div><ul class="args-list"></ul><div class="desc">This is a JOTPOT Server <a href="#url-object">URL object</a> that represents the URL that was requested by the client.<br>Limited extensions may not change the host of the request.url object. Between the request event and the fullrequest event, the pathname property has all occurences of '..', double slashes and any trailing slashes removed.</div></div>
			</div>
		</span>
		<br><br>
		<span ID="wsresponse-object">
			<h2>
				The 'wsresponse' object.
			</h2>
			<div class="indent">
				<p>This object is used to represent the WS communication from the server to the client.</p>
				<p>The most important consept to wsresponse is the difference between frames and messages, a message can be a single frame, or more than one frame. The wsresponse.write function is used to send a frame, if the isEnd argument is true, then when the client recieves this frame, it will create a message based on all frames recieved since the last end frame. So you could send a single frame that is the end and would thus be a message, or multiple frames in a row that all come togoether to make a message. Also, rather than calling wsresponse.write with the isEnd argument every time, you can rely on its default being false and use wsresponse.end to call wsresponse.write with isEnd as true. An important note here is that wsresponse.end doesn't end the session, it only ends the current frame, to end a session, call wsrequest.socket.end().</p>
				<p>For good practice, you should always use <a href="#wsresponse-que">wsresponse.que</a> to ensure to don't mix up frames for your messages.</p>
			</div>
			<div class="indent">
				<div ID="wsresponse-end"><h3 class="func-h3">wsresponse.end(data[, opcode])</h3><div class="details">Added: 26B</div><ul class="args-list"></ul><div class="desc">wsresponse.end = (data, opcode) => wsresponse.write(data, opcode, true) ;<br>So see <a href="#wsresponse-write">wsresponse.write</a>.</div></div><div ID="wsresponse-isEnded"><h3 class="func-h3">wsresponse.isEnded()</h3><div class="details">Added: 26B</div><ul class="args-list"></ul><div class="desc">Returns true if the last frame was a finish frame (so the current message is ended), or false if not.</div></div><div ID="wsresponse-que"><h3 class="func-h3">wsresponse.que(callback[, fasttrack])</h3><div class="details">Added: 26B</div><ul class="args-list"><li>callback &lt;Function&gt; Function to call when there are no open messages and it is at the top of the que.</li><li>fasttrack &lt;Boolean&gt; Whether or not to add this at the start of the que, defaults to false.</li></ul><div class="desc">Puts the given callback in a que, every time a message is ended (so a FIN frame sent), the first function in this que is called. If wsresponse.isEnded() returns true and the que is empty, the function will be called immediatally.<br>If fasttrack is true (defaults to false), the callback will be added at the start of the que, instead of the end.<br>Returns the new length of the que.</div></div><div ID="wsresponse-write"><h3 class="func-h3">wsresponse.write(data[, opcode][, isEnd])</h3><div class="details">Added: 26B</div><ul class="args-list"><li>data &lt;String&gt;|&lt;Buffer&gt; Data to send in this frame</li><li>opcode &lt;Number&gt; The opcode of this frame. It will be automatically set if not supplied.</li><li>isEnd &lt;Boolean&gt; If this is the last frame in the current message. Defaults to false.</li></ul><div class="desc">wsrequest.write writes a frame to the socket, the frame contains the given data and is sent with the specified opcode (defaults to 0 if the last frame wasn't a FIN frame, else 1 if data is a string, else 2 if data is a Buffer). isEnd determines if this is the final frame (so FIN is 1) and thus the message will be completed.</div></div>
			</div>
		</span>
	</div>
</div>
<jp-data-title>JOTPOT Server Docs</jp-data-title>
<script type="text/javascript">
	addClickListener(document.getElementById("the_link")) ;
</script>
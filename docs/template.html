<div ID="main-container">
<style>
	
	#main-container {
		
		font-family: Arial, Helvetica, sans-serif;
		background-color: #fff;
		color: #004;
		padding: 8px;
		padding-left: 20px;
		padding-right: 50px;
		text-align: left;
		
	}
	
	h1,h2,h3 {
		
		font-family: Arial, Helvetica, sans-serif;
		color: #008;
		
	}
	
	a {
		
		background-color: #e0e0e0;
		box-sizing: border-box;
		border-radius: 3px;
		padding: 3px;
		color: #008;
		
	}
	
	.details {
		
		padding: 0px;
		font-size: 0.9em;
		padding-left: 15px;
		
	}
	
	.details>ul {
		
		margin: 3px;
		margin-left: -15px;
		font-size: 0.85em;
		
	}
	
	.supported {
		
		color: green;
		
	}
	
	.notsupported {
		
		color: red;
		
	}
	
	.func-h3 {
		
		margin-bottom: 0px;
		
	}
	
	.args-list {
		
		font-size: 1.2em;
		margin-top: 3px;
		margin-bottom: 10px;
		padding-left: 45px;
		
	}
	
	.desc {
		
		font-size: 1.15em;
		padding-left: 55px;
		margin-top: -5px;
		
	}
	
	.indent {
		
		padding-left: 20px;
		
	}
	
</style>
<h1>JOTPOT Server Docs</h1>
<a href="/server" style="float: right;" ID="the_link">JOTPOT Server Main Page</a>
<div class="indent">
<i>Please note that this page is still a work in progress, and is no where near complete. It may not look the best yet but the content should be good :)</i>
<h2>The config.json file</h2>
<span class="indent">This JSON file contains the basic configuration for JOTPOT Server. There are simple versions and demo versions available from <a href="/server">jotpot.co.uk/server</a></span>
<div class="indent">
Properties:
	<br>
	<br>'httpServers': Array. Each item of the array should be an object containing the HTTP server options.
	<br>'httpsServers': Array. Each item of the array should be an object containing the HTTPS server options.
	<br>'redirectToHttps': Array. Each item of the array should be a string of any domains you want to be permanently redirected to the https version of the site.
	<br>'canBeHttp': Array. Each item should be paths you do NOT want redirecting to HTTPS if the domain normally gets redirected.
	<br>'dataPort': Number, the port you would like the data connections to come though, see data connections.
	<br>'hostRedirects': Object. Format: {"host_you_want_redirecting.com":"host_to_redirect_to.com"}
	<br>'hostAlias': Object. Similar to hostRedirects however rather then redirecting the server will handle the request as if it came from the domain you set - without the user being redirected.
	<br>'pageAlias': Object. The same as hostAlias however with pages instead. Note the format: {"example.com/page1":"example.com/page2"}. If the user goes to example.com/page2, it will be handles as if it were example.com/page1.
	<br>'addVarsByDefault': Boolean, true to replace anything served in the format "$:::&lt;var name>:::$" with the value of the variable or false to not replace be default.
	<br>'doVarsForIfNotByDefault': Array of Strings. The strings should be in the format: "&lt;hostname>/&lt;path>", any pages included in this array will have variables added to them even if doing them by default is set to false.
	<br>'cache': Array of Strings. Each item is in the format "&lt;host&gt;/&lt;page&gt;", this will be cached.
	<br>'errorTemplate': String. The file to use as the error page.
	<br>'defaultDomain': String. The domain to use by default if the http request contains no host header.
	<br>'useDefaultHostIfHostDoesNotExist': Boolean. true if the default host should be used like an alias if the host the user is requesting does not exist.
	<br>
	<br>HTTP Server Options:
	<br>'port': Number, the port you would like the server to be opened on.
	<br>
	<br>HTTPS Server Options:
	<br>'port': Number, the port you would like the server to be opened on.
</div>
<br><br>
<h2>What are JOTPOT Server extensions and how do they work?</h2>
<div class="indent">
	JOTPOT Server allows JavaScript files to be run and take control over the server, anything is possible via extensions and 'limited' extensions can be run to ensure an extension can only handle requests etc. from a specific domain/domains for security and stability.
	<br>
	Any file in the working directory of the server, with the full filename ending in '.jpe.js' will be loaded as extensions. There are 2 types of extensions, 'Master' extensions, and 'worker' extensions. JOTPOT Server runs using the 
	<a href="https://nodejs.org/dist/latest-v6.x/docs/api/cluster.html">Node.js cluster modules</a>, 
	this means that there is a master process and then an amount of workers. The master process runs all extensions (where the server.isMaster variable will be true) and each worker runs all the extensions (where the server.isMaster variable is false). 
	They have some shared API features however some different features.
	<br>
	Every extension is loaded with the standard Node.js require function, console object, setTimeout along with the setInterval and setImmediate functions.
	<br>
	There is also a 'server' object for controlling and interacting with the current JOTPOT Server instance, documented below.
	<br>
	The most key consent of extensions is server.handle, and for developing simple applications, it can be all that is needed.
</div>
<br><br>
<h2>'server' object</h2>
<div class="indent">
	<span>The server object is an object available is master and worker extensions, however with differences in each.</span>
	${formatObject("./server-docs.json")}
</div>
<br><br>
<h2>
	Server Events
</h2>
<div class="indent">
	JOTPOT Server has a serese of events that extensions can handle to add behavior to or to overwrite the behavior of.
	<br>
	Please see server.handle() for handling events.
	<br>
	<h3>
		Events:
	</h3>
	<ul>
		<li>'ready' event: This is the first event to fire, this event is fired when the current process is up and ready. This is fired for both master extensions and worker extensions and is the only event currently for master extensions. It cannot be overwritten, so the return value is ignored. The handler is called with no arguments.</li>
		<li>'request' event: This event is fired whenever a request is received, this event is fired before any redirects happen, such as redirects to HTTPS or redirects to the login page, so this should generally not be handled. The default behavior can be overwritten to if the handler returns true or returns a promise that resolves true, JOTPOT Server will stop handling the request. The handler is called with 2 arguments, the request object and the response object.</li>
		<li>'&lt;domain&gt;/request' event: This is the equivalent to the 'request' event however only fires for the domain before the '/'</li>
		<li>'fullrequest' event: This event is fired after a request is redirected and has page/host aliases applied, this event is however fired before any authentication checks happen, so this should generally not be handled if an account system is active of the page. The default behavior can be overwritten to if the handler returns true or returns a promise that resolves true, JOTPOT Server will stop handling the request. The handler is called with 2 arguments, the request object and the response object.</li>
		<li>'&lt;domain&gt;/fullrequest' event: This is the equivalent to the 'fullrequest' event however only fires for the domain before the '/'</li>
		<li>'allowedrequest' event: This event is fired when the server is ready to respond to the event, the user will have gone through all redirects, any aliases will have been applied and the user will be authenticated to access the page they are requesting. In most cases, this is the best event to handle for server side rendering, analytics and most other use cases.</li>
		<li>'&lt;domain&gt;/allowedrequest' event: This is the equivalent to the 'allowedrequest' event however only fires for the domain before the '/'</li>
	</ul>
</div>
<br><br>
<h2>
	Using server.handle
</h2>
<div class="indent">
	So, lets say you want to render a page serverside for the user, you could use the serveer.handle function to create this functionality.
	<br>
	When you handle any request event, so 'request', 'fullrequest', 'allowedrequest' or any host specific request, the handler function will receive 2 arguments, the request and the response object. These are documented below.
	<br>
	Here is an example:
	<pre>
	//Handle the request when we know it is allowed, to ensure that
	// we don't serve a page to a user that isn't logged in.
	server.handle('allowedrequest', (req, resp) => {
		
		//The request and response object have everything the standard
		// Node.js objects have however with some modified properties
		// and some additional ones.
		
		//Note how the domain is at the start of the req.url, see
		// req.url in the request docs below for how it is different.
		// You might also want to use req.purl here instead.
		if (req.url === 'www.exmaple.com/content.html') {
			
			//Call you own function to hamdle the request and the
			// response as you would in any other Node.js server.
			renderContentPage(req, resp) ;
			
			//Return true to say that this has handled the event
			// so the default behavior gets overwritten.
			return true ;
			
		}
		
		//If we haven't handled it, return false so the server 
		// continues with the default behavior for the request.
		return false ;
		
	});
	</pre>
</div>
<br>
<h2>
	The 'request' ('IncomingMessage') object.
</h2>
<div class="indent">
	The 'request' object is passed as the first argument to any hander function handling a request - with the second argument always been the response object. It is the <a href="https://nodejs.org/dist/latest-v6.x/docs/api/http.html#http_class_http_incomingmessage">Node.js IncomingMessage object</a> however has some modified properties and some added properties to make working with it easier. All of these changed/additional properties are listed below.
</div>
<div class="indent">
${formatObject("./req-docs.json")}
</div>
<br><br>
<h2>
	The 'response' ('ServerResponse') object.
</h2>
<div class="indent">
	The 'response' object is always passed to the request hander as the second argument, and similar to the 'request' object is the <a href="https://nodejs.org/dist/latest-v6.x/docs/api/http.html#http_class_http_serverresponse">Node.js ServerResponse object</a> however with a couple of added properties for ease of use. These added properties are documented below.
</div>
<div class="indent">
${formatObject("./resp-docs.json")}
</div>
</div>
</div>
<jp-data-title>JOTPOT Server Docs</jp-data-title>
<script type="text/javascript">
	addClickListener(document.getElementById("the_link")) ;
</script>